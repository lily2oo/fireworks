<!-- ドキュメントタイプを宣言 -->
<!DOCTYPE html>
<html>

<head>
  <!-- 文字化けをしないように文字コードを指定 -->
  <meta charset="UTF-8">

  <!-- google Fontsの読み込み -->
  <link
    href="https://fonts.googleapis.com/css?family=Chewy|Cookie|Limelight|Pacifico|Plaster|Sacramento|Satisfy|Stoke|Yellowtail|Geo|Oswald|Lobster"
    rel="stylesheet">

  <!-- CSSファイルを連携 -->
  <link rel="stylesheet" href="common.css">

  <!-- ライブラリを連携 -->
  <script src='library/p5.min.js'></script>
  <script src='library/p5.sound.min.js'></script>

  <!-- JavaScriptファイルを連携 -->
</head>

<body>
  <input type="button" id="permit" value="SafariでDeviceOrientationを許可" />
  <p id="test">thisis
  </p>
  <script type="text/javascript">
    let os;

    // DOM構築完了イベントハンドラ登録
    window.addEventListener("DOMContentLoaded", init);

    function init() {
      // 簡易的なOS判定
      os = detectOSSimply();
      if (os == "iphone") {
        // safari用。DeviceOrientation APIの使用をユーザに許可して貰う
        // permitDeviceOrientationForSafari();
        document.getElementById("test").innerHTML = "SP";
        document.querySelector("#permit").addEventListener("click", permitDeviceOrientationForSafari);
        window.addEventListener(
          "deviceorientation",
          orientation,
          true
        );
      } else {
        console.log("PC未対応サンプル");
        document.querySelector("#permit").addEventListener("click", failed);
        document.getElementById("test").innerHTML = "PC";
      }
    }

    function failed(){
      alert("failed");
    }

    function detectOSSimply() {
      let ret;
      if (
        navigator.userAgent.indexOf("iPhone") > 0 ||
        navigator.userAgent.indexOf("iPad") > 0 ||
        navigator.userAgent.indexOf("iPod") > 0
      ) {
        // iPad OS13のsafariはデフォルト「Macintosh」なので別途要対応
        ret = "iphone";
      } else {
        ret = "pc";
      }

      return ret;
    }

    function permitDeviceOrientationForSafari() {
      DeviceOrientationEvent.requestPermission()
        .then(response => {
          if (response === "granted") {
            window.addEventListener(
              "deviceorientation",
              detectDirection
            );
          }
        })
        .catch(console.error);
    }
  </script>
  <script src='script.js'></script>
</body>

</html>